<!DOCTYPE html>
<html lang="en">
<head>
  <base href="$FLUTTER_BASE_HREF">
  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  
  <!-- SEO Meta Tags -->
  <title>Vanishing Tic Tac Toe - Strategic Board Game with Disappearing Pieces</title>
  <meta name="description" content="Play Vanishing Tic Tac Toe, a strategic twist on the classic game where pieces vanish over time. Challenge friends or AI opponents with online multiplayer!">
  <meta name="keywords" content="vanishing tic tac toe, tic tac toe game, strategic board game, mobile game, flutter game, disappearing pieces, online multiplayer">
  
  <!-- iOS meta tags & icons -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Vanishing Tic Tac Toe">
  <link rel="apple-touch-icon" href="favicon_io/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="favicon_io/favicon.ico">
  <link rel="manifest" href="manifest.json">
  
  <!-- Direct font loading for Flutter web -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  
  <!-- Material Icons - Multiple formats for better browser compatibility -->
  <style>
    @font-face {
      font-family: 'Material Icons';
      font-style: normal;
      font-weight: 400;
      src: url(https://fonts.gstatic.com/s/materialicons/v140/flUhRq6tzZclQEJ-Vdg-IuiaDsNc.woff2) format('woff2');
    }
    
    /* Font Awesome */
    @font-face {
      font-family: 'Font Awesome 5 Free';
      font-style: normal;
      font-weight: 900;
      font-display: block;
      src: url(https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/webfonts/fa-solid-900.woff2) format('woff2');
    }
    
    @font-face {
      font-family: 'Font Awesome 5 Free';
      font-style: normal;
      font-weight: 400;
      font-display: block;
      src: url(https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/webfonts/fa-regular-400.woff2) format('woff2');
    }
    
    @font-face {
      font-family: 'Font Awesome 5 Brands';
      font-style: normal;
      font-weight: 400;
      font-display: block;
      src: url(https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/webfonts/fa-brands-400.woff2) format('woff2');
    }
  </style>
  
  <!-- Backup CSS links -->
  <!-- Load icon fonts with multiple fallback options -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Preload critical font files -->
  <link rel="preload" href="assets/fonts/MaterialIcons-Regular.ttf" as="font" type="font/ttf" crossorigin>
  <link rel="preload" href="assets/packages/font_awesome_flutter/lib/fonts/fa-solid-900.ttf" as="font" type="font/ttf" crossorigin>
  <link rel="preload" href="assets/packages/font_awesome_flutter/lib/fonts/fa-brands-400.ttf" as="font" type="font/ttf" crossorigin>
  
  <!-- Custom icons CSS -->
  <link rel="stylesheet" href="icons/icons.css">
  
  <!-- Icon styles with better compatibility -->
  <style>
    /* Material Icons */
    .material-icons {
      font-family: 'Material Icons', sans-serif;
      font-weight: normal;
      font-style: normal;
      font-size: 24px;
      line-height: 1;
      letter-spacing: normal;
      text-transform: none;
      display: inline-block;
      white-space: nowrap;
      word-wrap: normal;
      direction: ltr;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    /* Material Symbols */
    .material-symbols-outlined {
      font-family: 'Material Symbols Outlined', sans-serif;
      font-weight: normal;
      font-style: normal;
      font-size: 24px;
      line-height: 1;
      letter-spacing: normal;
      text-transform: none;
      display: inline-block;
      white-space: nowrap;
      word-wrap: normal;
      direction: ltr;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    /* Font Awesome styles */
    .fa, .fas {
      font-family: 'Font Awesome 5 Free', sans-serif;
      font-weight: 900;
      font-style: normal;
      font-variant: normal;
      text-rendering: auto;
      line-height: 1;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    .far {
      font-family: 'Font Awesome 5 Free', sans-serif;
      font-weight: 400;
      font-style: normal;
      font-variant: normal;
      text-rendering: auto;
      line-height: 1;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    .fab {
      font-family: 'Font Awesome 5 Brands', sans-serif;
      font-weight: 400;
      font-style: normal;
      font-variant: normal;
      text-rendering: auto;
      line-height: 1;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    /* Ensure Flutter icons display properly */
    @font-face {
      font-family: 'MaterialIcons';
      src: url('assets/fonts/MaterialIcons-Regular.ttf') format('truetype'),
           url('https://fonts.gstatic.com/s/materialicons/v140/flUhRq6tzZclQEJ-Vdg-IuiaDsNc.woff2') format('woff2');
      font-weight: normal;
      font-style: normal;
      font-display: block;
    }
  </style>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-analytics-compat.js"></script>

  <!-- Flutter initialization -->
  <script src="flutter.js" defer></script>
</head>
<body>
  <!-- Firebase Configuration -->
  <script src="firebase-config.js"></script>
  <script>
    // Make Firebase config available to Flutter but don't initialize Firebase here
    // This allows Flutter to handle the initialization
    window.firebaseConfig = window.firebaseConfig || {};
    
    // This function will be called by Flutter when it's ready to initialize Firebase
    window.initializeFirebase = function() {
      // Check if Firebase is already initialized
      if (firebase.apps.length === 0) {
        const firebaseApp = firebase.initializeApp(window.firebaseConfig);
        const db = firebase.firestore();
        db.settings({
          ignoreUndefinedProperties: true,
          cacheSizeBytes: firebase.firestore.CACHE_SIZE_UNLIMITED
        });
        console.log('Firebase initialized successfully by Flutter');
        return true;
      } else {
        console.log('Firebase already initialized');
        return false;
      }
    };
  </script>

  <!-- Script to help debug icon loading issues -->
  <script>
    // Enhanced function to check and fix font loading
    function checkFontsLoaded() {
      console.log('Checking if icon fonts are loaded...');
      document.fonts.ready.then(function() {
        console.log('System reports fonts are loaded');
        
        // Try multiple font names to handle different versions
        const materialIconsLoaded = document.fonts.check('1em "Material Icons"') || 
                                    document.fonts.check('1em "MaterialIcons"');
        
        // Check for both Font Awesome 5 and 6 to handle different versions
        const fontAwesomeSolidLoaded = document.fonts.check('1em "Font Awesome 5 Free"') || 
                                       document.fonts.check('1em "Font Awesome 6 Free"') ||
                                       document.fonts.check('1em "FontAwesome"');
        
        const fontAwesomeBrandsLoaded = document.fonts.check('1em "Font Awesome 5 Brands"') || 
                                        document.fonts.check('1em "Font Awesome 6 Brands"');
        
        console.log('Material Icons loaded:', materialIconsLoaded);
        console.log('Font Awesome Solid loaded:', fontAwesomeSolidLoaded);
        console.log('Font Awesome Brands loaded:', fontAwesomeBrandsLoaded);
        
        // Always inject fonts to ensure they're available
        console.log('Injecting font definitions to ensure availability...');
        console.warn('Ensuring font availability by injecting font definitions...');
          
        // Inject font styles directly
        const style = document.createElement('style');
        style.textContent = `
            @font-face {
              font-family: 'Material Icons';
              src: url('assets/fonts/MaterialIcons-Regular.ttf') format('truetype');
              font-weight: normal;
              font-style: normal;
            }
            
            @font-face {
              font-family: 'Font Awesome 5 Free';
              src: url('assets/packages/font_awesome_flutter/lib/fonts/fa-solid-900.ttf') format('truetype');
              font-weight: 900;
              font-style: normal;
            }
            
            @font-face {
              font-family: 'Font Awesome 5 Free';
              src: url('assets/packages/font_awesome_flutter/lib/fonts/fa-regular-400.ttf') format('truetype');
              font-weight: 400;
              font-style: normal;
            }
            
            @font-face {
              font-family: 'Font Awesome 5 Brands';
              src: url('assets/packages/font_awesome_flutter/lib/fonts/fa-brands-400.ttf') format('truetype');
              font-weight: normal;
              font-style: normal;
            }
          `;
        document.head.appendChild(style);
        
        // Force reload of stylesheets
        const links = document.querySelectorAll('link[rel="stylesheet"]');
        links.forEach(link => {
          const href = link.getAttribute('href');
          if (href && (href.includes('material') || href.includes('font-awesome'))) {
            const newLink = document.createElement('link');
            newLink.rel = 'stylesheet';
            newLink.href = href + '?reload=' + new Date().getTime();
            link.parentNode.replaceChild(newLink, link);
          }
        });
      });
    }
    
    window.addEventListener('load', function() {
      // Check fonts after a short delay
      setTimeout(checkFontsLoaded, 1000);
      // Handle errors
      window.addEventListener('error', function(e) {
        console.error('App Error:', e.message, e);
      });

      // Handle unhandled promise rejections
      window.addEventListener('unhandledrejection', function(event) {
        console.error('Unhandled Promise Rejection:', event.reason);
      });

      // Flutter initialization
      const serviceWorkerVersion = '{{flutter_service_worker_version}}';
      
      // Load main.dart.js
      const scriptTag = document.createElement('script');
      scriptTag.src = 'main.dart.js';
      scriptTag.type = 'application/javascript';
      document.body.appendChild(scriptTag);
      
      // Register service worker
      if ('serviceWorker' in navigator) {
        window.addEventListener('flutter-first-frame', function() {
          navigator.serviceWorker.register('flutter_service_worker.js?v=' + serviceWorkerVersion);
        });
      }
      
      // Listen for Flutter initialization
      window.addEventListener('flutter-first-frame', function() {
        console.log('Flutter web app is ready!');
      });
    });
    
    // Add a global function to force icon refresh that can be called from Flutter
    window.refreshIcons = function() {
      console.log('Manual icon refresh requested');
      checkFontsLoaded();
      return true;
    };
  </script>
  
  <!-- Service Worker Registration -->
  <script src="service-worker-registration.js"></script>
</body>
</html>